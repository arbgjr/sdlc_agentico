---
# Compliance Assessment
# Generated by: compliance-guardian
# Phase: 0 (Preparation)
# Date: 2026-02-12T20:10:47Z

compliance_assessment:
  request_id: "REQ-20260212-001"
  assessed_at: "2026-02-12T20:10:47Z"
  assessor: "compliance-guardian"

  scope:
    feature: "GitHub Metrics Collector - Multi-Enterprise Analytics Platform"
    data_types:
      - type: "usage_metrics"
        examples:
          - "Copilot acceptance rates"
          - "Code suggestions count"
          - "Active user counts"
        sensitivity: "medium"

      - type: "engineering_metrics"
        examples:
          - "Commit frequency per developer"
          - "PR review times"
          - "Deploy frequency"
        sensitivity: "medium-high"

      - type: "identification_data"
        examples:
          - "GitHub usernames"
          - "Email addresses (from commits)"
          - "Organization membership"
        sensitivity: "high"

      - type: "credentials"
        examples:
          - "GitHub API tokens"
          - "Organization admin tokens"
        sensitivity: "critical"

  applicable_regulations:
    - regulation: "Corporate Data Policy"
      sections:
        - "Data Classification"
        - "Access Control"
        - "Data Retention"
      notes: "Metricas de produtividade sao dados corporativos sensiveis"

    - regulation: "Internal Security Policy"
      sections:
        - "API Credentials Management"
        - "Secrets Storage"
        - "Audit Logging"

    - regulation: "LGPD Considerations"
      articles:
        - "Art. 7 - Legitimate Interest"
        - "Art. 18 - Data Subject Rights"
      notes: |
        Se metricas individuais forem coletadas, titular dos dados
        (desenvolvedor) tem direitos sobre seus dados de uso.
        Recomendacao: Agregar dados para evitar identificacao individual.

  controls_assessment:
    - control: "Segregacao de Dados por Organizacao"
      status: "required"
      requirement: "Dados das 2 organizacoes devem ser segregados"
      implementation: |
        - Armazenamento em tabelas/namespaces separados
        - Filtros de acesso por organizacao
        - Labels de origem em todos os registros
      severity: "HIGH"

    - control: "Protecao de Credenciais"
      status: "required"
      requirement: "Tokens de API nao podem ser armazenados em codigo"
      implementation: |
        - Usar Azure Key Vault ou GitHub Secrets
        - Rotacao periodica de tokens
        - Audit log de acesso aos secrets
      severity: "CRITICAL"

    - control: "Anonimizacao de Dados Individuais"
      status: "recommended"
      requirement: "Metricas agregadas preferenciais sobre individuais"
      implementation: |
        - Agregar por equipe ao inves de individual
        - Se individual necessario, hash de username
        - Opt-out para desenvolvedores (se aplicavel)
      severity: "MEDIUM"
      notes: "Depende da decisao sobre metricas individuais vs agregadas"

    - control: "Rate Limiting e Retry Logic"
      status: "required"
      requirement: "Respeitar limites de API do GitHub"
      implementation: |
        - Implementar exponential backoff
        - Monitorar rate limit headers
        - Distribuir coleta ao longo do tempo
      severity: "MEDIUM"

    - control: "Audit Trail"
      status: "required"
      requirement: "Log de todas as coletas e acessos aos dados"
      implementation: |
        - Log de cada job de coleta (timestamp, org, metricas)
        - Log de acesso aos dashboards/exports
        - Retencao de logs por 1 ano minimo
      severity: "HIGH"

    - control: "Retencao de Dados"
      status: "required"
      requirement: "Politica de retencao deve ser definida"
      implementation: |
        - Definir periodo de retencao (sugestao: 2 anos)
        - Automatizar purge de dados antigos
        - Documentar politica
      severity: "MEDIUM"

    - control: "Acesso Restrito"
      status: "required"
      requirement: "Apenas usuarios autorizados acessam metricas"
      implementation: |
        - Autenticacao via Azure AD/SSO
        - Role-based access (Admin, Viewer)
        - Segregacao de acesso por organizacao
      severity: "HIGH"

  risk_summary:
    critical: 1  # Protecao de credenciais
    high: 3      # Segregacao, Audit Trail, Acesso Restrito
    medium: 3    # Anonimizacao, Rate Limiting, Retencao
    low: 0

  verdict: "APPROVED_WITH_CONDITIONS"

  conditions:
    - condition: "Credenciais em secrets manager"
      description: "Todos os tokens GitHub devem ser armazenados em Key Vault ou equivalente"
      blocking: true
      phase_deadline: "Phase 5 (Implementation)"

    - condition: "Segregacao de dados"
      description: "Implementar segregacao logica entre organizacoes"
      blocking: true
      phase_deadline: "Phase 3 (Architecture)"

    - condition: "Decisao sobre anonimizacao"
      description: "Definir se metricas individuais serao coletadas ou agregadas"
      blocking: true
      phase_deadline: "Phase 2 (Requirements)"

    - condition: "Politica de retencao"
      description: "Documentar e implementar politica de retencao"
      blocking: false
      phase_deadline: "Phase 7 (Release)"

  required_actions:
    - action: "Definir estrategia de anonimizacao"
      owner: "product-owner"
      deadline: "Phase 2"
      blocking: true
      rationale: "Impacta modelo de dados e compliance LGPD"

    - action: "Documentar arquitetura de secrets"
      owner: "system-architect"
      deadline: "Phase 3"
      blocking: true
      rationale: "Credenciais sao dados criticos"

    - action: "Definir politica de retencao"
      owner: "product-owner"
      deadline: "Phase 2"
      blocking: false
      rationale: "Necessario para compliance e gestao de storage"

    - action: "Mapear acessos e roles"
      owner: "system-architect"
      deadline: "Phase 3"
      blocking: true
      rationale: "Controle de acesso e requisito de seguranca"

  next_assessment: "Phase 3 - Validar arquitetura de seguranca"

  recommendations:
    - "Usar GitHub App ao inves de Personal Access Token para autenticacao"
    - "Implementar renovacao automatica de tokens"
    - "Considerar data warehouse com row-level security para PowerBI"
    - "Adicionar monitoramento de acessos anomalos"
    - "Documentar procedimento de revogacao de acesso em caso de incidente"

  security_gates:
    phase_2_to_3:
      - "Requisitos de seguranca documentados"
      - "Decisao sobre anonimizacao registrada"

    phase_3_to_4:
      - "Arquitetura de secrets aprovada"
      - "Modelo de segregacao definido"

    phase_5_to_6:
      - "Secrets em key vault (nao em codigo)"
      - "Audit logging implementado"

    phase_6_to_7:
      - "Security scan sem vulnerabilidades criticas"
      - "Penetration test (se aplicavel)"
      - "Compliance checklist completo"
