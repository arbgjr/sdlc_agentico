---
# Non-Functional Requirements (NFR) Document
# GitHub Metrics Collector
# Generated by: requirements-analyst
# Phase: 2 (Requirements)
# Date: 2026-02-12T20:39:19Z

project:
  id: "metrics-collector-20260212"
  name: "GitHub Metrics Collector"
  version: "1.0"

nfr_document:

  # ========== SECURITY ==========
  security:
    - id: "NFR-SEC-001"
      title: "Credential Storage"
      description: "Tokens de API GitHub devem ser armazenados em secrets manager"
      requirement: |
        - Azure Key Vault como armazenamento primario
        - Managed Identity para acesso (sem secrets no codigo)
        - Rotacao de tokens suportada sem downtime
        - Audit log de acesso aos secrets
      measurement: "Audit de configuracao e codigo fonte"
      priority: must
      compliance: ["Corporate Security Policy"]

    - id: "NFR-SEC-002"
      title: "Data Segregation"
      description: "Dados de cada organizacao devem ser isolados"
      requirement: |
        - Schemas separados no banco (schema: org_a, org_b)
        - Labels de origem em todos os registros (org_id)
        - Row-level security se necessario para PowerBI
        - Nenhum cross-org query permitido sem autorizacao
      measurement: "Testes de isolamento, code review"
      priority: must
      compliance: ["Corporate Data Policy"]

    - id: "NFR-SEC-003"
      title: "API Authentication"
      description: "Autenticacao segura com APIs do GitHub"
      requirement: |
        - Classic PAT para endpoints enterprise (obrigatorio)
        - GitHub App para endpoints de repositorio (preferivel)
        - Tokens com minimo de permissoes necessarias
        - Expiracao de tokens configurada
      measurement: "Audit de permissoes de tokens"
      priority: must
      compliance: ["GitHub Security Best Practices"]

    - id: "NFR-SEC-004"
      title: "Audit Trail"
      description: "Log de todas as operacoes de coleta e acesso"
      requirement: |
        - Log de cada execucao de coleta (timestamp, org, metricas)
        - Log de acessos ao banco de dados
        - Log de acessos ao Key Vault
        - Retencao de logs por 1 ano minimo
      measurement: "Verificacao de logs em ambiente de producao"
      priority: must
      compliance: ["Corporate Audit Policy"]

    - id: "NFR-SEC-005"
      title: "Network Security"
      description: "Comunicacao segura entre componentes"
      requirement: |
        - TLS 1.2+ para todas as conexoes
        - VNet integration para Azure SQL (se Azure)
        - Private endpoints quando possivel
      measurement: "Network security scan"
      priority: should
      compliance: ["Corporate Network Policy"]

  # ========== PERFORMANCE ==========
  performance:
    - id: "NFR-PERF-001"
      title: "API Rate Limit Compliance"
      description: "Respeitar limites de API do GitHub"
      requirement: |
        - Max 5000 requests/hour (REST API authenticated)
        - Max 5000 points/hour (GraphQL API)
        - Implementar exponential backoff
        - Monitorar headers X-RateLimit-*
      measurement: "Logs de rate limit, metricas de API calls"
      priority: must

    - id: "NFR-PERF-002"
      title: "Collection Time"
      description: "Tempo total de coleta diaria"
      requirement: |
        - Coleta completa em < 4 horas
        - Suportar coleta incremental
        - Paralelizacao por organizacao
      measurement: "Tempo medio de execucao em logs"
      priority: should

    - id: "NFR-PERF-003"
      title: "Query Performance"
      description: "Tempo de resposta para queries PowerBI"
      requirement: |
        - Queries tipicas < 5 segundos
        - Indices otimizados para filtros comuns (date, user, repo)
        - Agregacoes pre-calculadas para metricas complexas
      measurement: "Query execution time em logs de banco"
      priority: should

  # ========== AVAILABILITY ==========
  availability:
    - id: "NFR-AVAIL-001"
      title: "Collection Reliability"
      description: "Coleta deve ser resiliente a falhas"
      requirement: |
        - Retry automatico em caso de erro transiente
        - Checkpoint de progresso (resume de onde parou)
        - Alerta em caso de falha persistente
        - Nao perder dados ja coletados
      measurement: "Sucesso rate de coletas ao longo do tempo"
      priority: must

    - id: "NFR-AVAIL-002"
      title: "Data Availability"
      description: "Dados disponiveis para consulta"
      requirement: |
        - Dados disponiveis apos coleta diaria
        - SLA de banco de dados: 99.9% (Azure SQL)
        - Backup automatico diario
      measurement: "Uptime do banco de dados"
      priority: should

  # ========== SCALABILITY ==========
  scalability:
    - id: "NFR-SCALE-001"
      title: "Data Volume"
      description: "Suportar volume esperado de dados"
      requirement: |
        - 1K-100K registros/dia
        - Dezenas de repositorios
        - Centenas de usuarios
        - 3 anos de historico (projecao: ~100M registros)
      measurement: "Testes de carga com dados sinteticos"
      priority: must

    - id: "NFR-SCALE-002"
      title: "Organization Scaling"
      description: "Adicionar novas organizacoes"
      requirement: |
        - Configuracao por org (tokens, repos)
        - Schema dinamico por org
        - Sem redesign para adicionar 3a org
      measurement: "Documentacao de procedimento"
      priority: should

  # ========== DATA MANAGEMENT ==========
  data:
    - id: "NFR-DATA-001"
      title: "Data Retention"
      description: "Politica de retencao de dados"
      requirement: |
        - Dados de metricas: 3 anos
        - Dados de logs: 1 ano
        - Purge automatico de dados antigos
        - Processo de archive antes de purge (opcional)
      measurement: "Verificacao de politica implementada"
      priority: should

    - id: "NFR-DATA-002"
      title: "Data Quality"
      description: "Qualidade dos dados coletados"
      requirement: |
        - Validacao de schema na coleta
        - Deteccao de dados duplicados
        - Tratamento de valores nulos
        - Log de anomalias
      measurement: "Data quality reports"
      priority: should

    - id: "NFR-DATA-003"
      title: "Data Consistency"
      description: "Consistencia de dados entre coletas"
      requirement: |
        - Idempotencia na coleta (re-run seguro)
        - Timestamp de coleta em todos os registros
        - Versionamento de metricas recalculadas
      measurement: "Testes de idempotencia"
      priority: must

  # ========== OBSERVABILITY ==========
  observability:
    - id: "NFR-OBS-001"
      title: "Logging"
      description: "Logs estruturados para todas as operacoes"
      requirement: |
        - Formato JSON para logs
        - Correlation ID para rastreamento
        - Niveis: DEBUG, INFO, WARN, ERROR
        - Centralizacao (Azure Log Analytics ou similar)
      measurement: "Verificacao de logs em producao"
      priority: must

    - id: "NFR-OBS-002"
      title: "Metrics"
      description: "Metricas operacionais do coletor"
      requirement: |
        - Collection time per org
        - API calls per run
        - Error rate
        - Records collected per run
      measurement: "Dashboard operacional"
      priority: should

    - id: "NFR-OBS-003"
      title: "Alerting"
      description: "Alertas para problemas operacionais"
      requirement: |
        - Alerta se coleta falhar 2x consecutivas
        - Alerta se rate limit atingido
        - Alerta se tempo de coleta > 8 horas
        - Canal: email e/ou Teams
      measurement: "Teste de alertas"
      priority: should

  # ========== MAINTAINABILITY ==========
  maintainability:
    - id: "NFR-MAINT-001"
      title: "Configuration"
      description: "Configuracao externalizavel"
      requirement: |
        - Todas as configs em arquivos/env vars
        - Sem hardcode de URLs, tokens, IDs
        - Documentacao de todas as configs
      measurement: "Code review"
      priority: must

    - id: "NFR-MAINT-002"
      title: "Documentation"
      description: "Documentacao tecnica completa"
      requirement: |
        - README com setup instructions
        - Schema do banco documentado
        - Runbook operacional
        - ADRs para decisoes arquiteturais
      measurement: "Existencia e qualidade da documentacao"
      priority: should

summary:
  total_nfrs: 18
  by_category:
    security: 5
    performance: 3
    availability: 2
    scalability: 2
    data: 3
    observability: 3
    maintainability: 2
  by_priority:
    must: 10
    should: 8
