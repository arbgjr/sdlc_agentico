# GitHub Metrics Collector - Domain Knowledge

**Generated by**: domain-researcher
**Phase**: 1 (Discovery)
**Date**: 2026-02-12

---

## Overview

This document captures the domain knowledge required to build a GitHub metrics collection system targeting DORA metrics, Velocity metrics, and GitHub Copilot usage metrics for Enterprise Cloud organizations.

---

## 1. GitHub Copilot Usage Metrics

### 1.1 API Access

GitHub provides REST API endpoints for Copilot metrics at multiple levels:

| Level | Endpoint | Auth Required |
|-------|----------|---------------|
| Enterprise | `/enterprises/{enterprise}/copilot/metrics` | `manage_billing:copilot` or `read:enterprise` |
| Organization | `/orgs/{org}/copilot/metrics` | `manage_billing:copilot` or `read:org` |
| Team | `/orgs/{org}/team/{team_slug}/copilot/metrics` | Same as org |

**Important**: Enterprise endpoints do NOT support fine-grained PATs or GitHub App tokens. Must use classic PAT.

### 1.2 Available Metrics

**Adoption Metrics**:
- Daily Active Users (DAU)
- Weekly Active Users (WAU)
- Monthly Active Users (MAU)
- Agent Adoption Rate

**Code Completion Metrics**:
- Acceptance Rate = Suggestions Accepted / Suggestions Shown
- Total Suggestions Shown
- Total Suggestions Accepted

**Usage Breakdown**:
- By Programming Language
- By Editor/IDE
- By AI Model

**Code Generation**:
- Lines of Code Suggested
- Lines of Code Actually Added
- User-Initiated Interactions

### 1.3 Data Characteristics

- **Freshness**: Data available within 3 full UTC days
- **Historical Range**: Up to 100 days
- **Privacy Threshold**: Minimum 5 licensed users required

### 1.4 CRITICAL: Deprecation Notice

The current Copilot metrics endpoints (`/copilot/metrics`) will cease operation on **April 2, 2026**. The project must use the newer Copilot usage metrics endpoints from the start.

---

## 2. DORA Metrics

### 2.1 Deployment Frequency

**Definition**: How often an organization successfully deploys to production.

**Calculation**:
```
Deployment Frequency = Count of successful deployments / Time period
```

**GitHub Data Source**:
- Workflow runs: `GET /repos/{owner}/{repo}/actions/runs?branch=main&status=success`
- Filter by conclusion = "success"

**Performance Levels**:
| Level | Frequency |
|-------|-----------|
| Elite | Multiple per day |
| High | Between once per day and once per week |
| Medium | Between once per week and once per month |
| Low | Less than once per month |

### 2.2 Lead Time for Changes

**Definition**: Time from code commit to running in production.

**Calculation**:
```
Lead Time = (PR Merge Time - First Commit Time) + (Deploy Time - PR Merge Time)
```

**GitHub Data Sources**:
1. PRs: `GET /repos/{owner}/{repo}/pulls?state=closed`
2. PR Commits: `GET /repos/{owner}/{repo}/pulls/{n}/commits`
3. Workflow Runs: `GET /repos/{owner}/{repo}/actions/runs`

**Performance Levels**:
| Level | Lead Time |
|-------|-----------|
| Elite | Less than 1 hour |
| High | Between 1 day and 1 week |
| Medium | Between 1 week and 1 month |
| Low | More than 6 months |

### 2.3 Mean Time to Recovery (MTTR)

**Definition**: How long it takes to recover from a failure in production.

**Calculation**:
```
MTTR = Average(Incident Resolved Time - Incident Detected Time)
```

**Challenge**: GitHub does not natively track production incidents.

**Workarounds**:
1. Use GitHub Issues with "incident" label
2. Integrate with PagerDuty/OpsGenie
3. Track rollback commits

**Performance Levels**:
| Level | MTTR |
|-------|------|
| Elite | Less than 1 hour |
| High | Less than 1 day |
| Medium | Between 1 day and 1 week |
| Low | More than 1 week |

### 2.4 Change Failure Rate

**Definition**: Percentage of deployments causing a failure in production.

**Calculation**:
```
Change Failure Rate = (Failed Deployments / Total Deployments) * 100
```

**Challenge**: Requires classification of which deployments failed.

**Workarounds**:
1. Manual classification
2. Detect rollback workflows
3. Track issues linked to releases

**Performance Levels**:
| Level | Rate |
|-------|------|
| Elite | 0-15% |
| High | 16-30% |
| Medium | 31-45% |
| Low | 46-60% |

---

## 3. Velocity Metrics

### 3.1 Commit Frequency

**Definition**: How often developers commit code.

**Calculation**:
```
Commit Frequency = Total Commits / Time Period / Active Developers
```

**GitHub Data Sources**:
- Commits: `GET /repos/{owner}/{repo}/commits`
- Contributors: `GET /repos/{owner}/{repo}/stats/contributors`

### 3.2 PR Throughput

**Definition**: Number of pull requests merged per time period.

**Calculation**:
```
PR Throughput = Count of Merged PRs / Time Period
```

**GitHub Data Source**:
- PRs: `GET /repos/{owner}/{repo}/pulls?state=closed`
- Filter: `merged_at IS NOT NULL`

### 3.3 Review Time

**Definition**: Time from PR creation to first review.

**Calculation**:
```
Review Time = Average(First Review Time - PR Created Time)
```

**GitHub Data Sources**:
1. PRs: `GET /repos/{owner}/{repo}/pulls`
2. Reviews: `GET /repos/{owner}/{repo}/pulls/{n}/reviews`

### 3.4 Code Churn

**Definition**: Amount of code change (additions vs deletions) over time.

**Calculation**:
```
Code Churn = (Lines Added + Lines Deleted) / Time Period
```

**GitHub Data Source**:
- Code frequency: `GET /repos/{owner}/{repo}/stats/code_frequency`

---

## 4. API Rate Limits

### REST API
- **Authenticated**: 5,000 requests per hour
- **GitHub App**: 15,000 requests per hour (installation token)
- **Headers**: `X-RateLimit-Remaining`, `X-RateLimit-Reset`

### GraphQL API
- **Point-based**: 5,000 points per hour
- **Calculation**: Varies by query complexity
- **Recommendation**: Use for bulk data retrieval

### Best Practices
1. Implement exponential backoff
2. Cache responses locally
3. Use conditional requests (If-None-Match)
4. Process incrementally (since last run)

---

## 5. Authentication Strategy

### For Repository Data (Commits, PRs, Workflows)
**Recommendation**: GitHub App

**Pros**:
- Higher rate limits (15,000/hour)
- Per-repository installation
- Better security (short-lived tokens)

**Cons**:
- More complex setup
- Need app installation per organization

### For Enterprise Copilot Data
**Requirement**: Classic Personal Access Token

**Reason**: Enterprise Copilot endpoints do not support:
- Fine-grained PATs
- GitHub App user tokens
- GitHub App installation tokens

**Required Scopes**:
- `manage_billing:copilot` OR `read:enterprise`

---

## 6. Multi-Organization Considerations

### Data Isolation
- Each organization's data must be segregated
- Separate authentication tokens per organization
- No cross-organization data leakage

### Token Management
- Store tokens in secret manager (Azure Key Vault)
- Rotate tokens periodically
- Audit token usage

### Aggregation Strategy
- Collect data per organization
- Aggregate at reporting layer (PowerBI)
- Maintain organization labels on all records

---

## 7. PowerBI Integration

### Export Formats
| Format | Pros | Cons |
|--------|------|------|
| CSV | Simple, universal | Large files, no schema |
| Parquet | Compressed, schema | Requires setup |
| Direct Query | Real-time | Complex, API limits |
| Azure SQL | Native integration | Cost, setup |

### Recommended Approach
1. Store processed data in Azure SQL or Parquet files
2. Configure PowerBI DirectQuery or Import mode
3. Create date tables for time-series analysis
4. Build calculated measures in DAX

---

## 8. Glossary

| Term | Definition |
|------|------------|
| **DAU** | Daily Active Users |
| **DORA** | DevOps Research and Assessment |
| **Lead Time** | Time from commit to production |
| **MTTR** | Mean Time to Recovery |
| **PAT** | Personal Access Token |
| **PR** | Pull Request |
| **WAU** | Weekly Active Users |

---

## 9. References

- [GitHub Copilot Usage Metrics](https://docs.github.com/en/enterprise-cloud@latest/copilot/concepts/copilot-metrics)
- [GitHub REST API](https://docs.github.com/en/rest)
- [GitHub GraphQL API](https://docs.github.com/en/graphql)
- [DORA Metrics](https://dora.dev/)
- [DeveloperMetrics/DevOpsMetrics](https://github.com/DeveloperMetrics/DevOpsMetrics)

---

*Generated by SDLC Agentico - Phase 1 Discovery*
