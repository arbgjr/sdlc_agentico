# Demo Custom Gate - Simple Validation Example
# Client: demo-client
# Phase Transition: 6 (Quality) ‚Üí 7 (Release)
# Purpose: Minimal example of custom quality gate (NOT domain-specific)

gate_name: "demo-custom-gate"
phase_transition: "6-to-7"
description: |
  Example custom gate validating ADR completeness.
  This is a SIMPLE, GENERIC check - not industry-specific.

# Required checks (all must pass)
checks:
  - id: "adr-impact-section-exists"
    type: "grep"
    description: "All ADRs must have 'Impact' or 'Consequences' section"
    command: |
      # Find all ADR files
      adr_files=$(find .project/corpus/nodes/decisions -name "ADR-*.yml" -o -name "adr-*.yml" 2>/dev/null)

      if [ -z "$adr_files" ]; then
        echo "No ADRs found - skipping check"
        exit 0
      fi

      missing_impact=0
      for adr in $adr_files; do
        if ! grep -qiE "(impact|consequences):" "$adr"; then
          echo "‚ùå ADR missing Impact/Consequences section: $adr"
          missing_impact=$((missing_impact + 1))
        fi
      done

      if [ $missing_impact -gt 0 ]; then
        echo ""
        echo "Found $missing_impact ADR(s) without Impact/Consequences section"
        echo ""
        echo "Fix: Add one of these sections to each ADR:"
        echo "  - impact:"
        echo "  - consequences:"
        exit 1
      fi

      echo "‚úÖ All ADRs have Impact/Consequences section"
    severity: "medium"
    blocking: false

  - id: "readme-exists"
    type: "file_exists"
    description: "Project must have a README.md file"
    path: "README.md"
    severity: "low"
    blocking: false

# Optional checks (warnings only)
warnings:
  - id: "changelog-exists"
    type: "file_exists"
    description: "Consider adding CHANGELOG.md for release notes"
    path: "CHANGELOG.md"
    severity: "info"
    message: |
      üí° Tip: Create CHANGELOG.md to track version changes
      This helps users understand what changed between releases.

# Gate configuration
config:
  auto_approve: true  # Don't block workflow if checks pass
  allow_override: true  # Can be manually overridden if needed
  timeout: 30  # seconds

# Metadata
metadata:
  version: "1.0.0"
  author: "demo-client"
  created: "2026-01-31"
  purpose: "Demonstration of custom gate mechanics (non-domain-specific)"
  real_world_usage: |
    In production, clients would add gates like:
    - Financial: SOX compliance checks
    - Healthcare: HIPAA data validation
    - Government: Security clearance verification

    This is intentionally SIMPLE to show mechanics, not to specialize framework.
