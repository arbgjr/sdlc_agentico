# Gate: Phase 3 (Architecture) -> Phase 4 (Planning)
# Valida que arquitetura foi definida e decisoes documentadas

gate:
  name: "Architecture to Planning"
  from_phase: 3
  to_phase: 4
  description: "Valida que design de arquitetura esta completo"

required_artifacts:
  - name: "Architecture Overview"
    path: ".agentic_sdlc/projects/*/architecture/*.md"
    fallback_path: ".specify/plans/*.md"
    description: "Documento de arquitetura de alto nivel"
    agent: "system-architect"

  - name: "ADRs"
    path: ".agentic_sdlc/projects/*/decisions/adr-*.yml"
    fallback_path: "docs/adr/*.md"
    description: "Architecture Decision Records para decisoes significativas"
    agent: "adr-author"

  - name: "Technical Plan"
    path: ".agentic_sdlc/projects/*/plans/*-technical-plan.md"
    fallback_path: ".specify/plans/*-technical-plan.md"
    description: "Plano tecnico detalhado"
    agent: "system-architect"

  - name: "Data Model"
    path: ".agentic_sdlc/projects/*/data/*.md"
    fallback_path: "docs/data/*.md"
    description: "Modelo de dados e relacionamentos"
    agent: "data-architect"

  - name: "API Contracts"
    path: ".agentic_sdlc/projects/*/api/*.yml"
    fallback_path: "docs/api/*.yml"
    description: "Contratos de API (OpenAPI/AsyncAPI)"
    agent: "data-architect"
    optional_for_levels: [0, 1]

  - name: "Threat Model"
    path: ".agentic_sdlc/projects/*/security/threat-model*.yml"
    fallback_path: ".claude/memory/security/*.yml"
    description: "Analise de ameacas STRIDE"
    agent: "threat-modeler"

quality_checks:
  - check: "Componentes definidos"
    validation: "grep -r 'components:' .agentic_sdlc/projects/*/architecture/ .specify/plans/ 2>/dev/null | head -1"

  - check: "Tecnologias escolhidas"
    validation: "grep -r 'technology_choices:' .agentic_sdlc/projects/*/architecture/ .specify/plans/ 2>/dev/null | head -1"

  - check: "NFRs enderecados"
    validation: "grep -r 'nfr_approach:' .agentic_sdlc/projects/*/architecture/ .specify/plans/ 2>/dev/null | head -1"

  - check: "Trade-offs documentados"
    validation: "ls .agentic_sdlc/projects/*/decisions/adr-*.yml docs/adr/*.md 2>/dev/null | head -1"

  - check: "Threat model realizado"
    validation: "grep -r 'threat_model:' .agentic_sdlc/projects/*/security/ .claude/memory/ 2>/dev/null | head -1"

  - check: "Modelo de dados definido"
    validation: "grep -r 'entities:' .agentic_sdlc/projects/*/data/ docs/data/ 2>/dev/null | head -1"

  - check: "Contratos de API especificados"
    validation: "ls .agentic_sdlc/projects/*/api/*.yml docs/api/*.yml 2>/dev/null | head -1"

human_approval:
  required: true
  approvers:
    - role: "Tech Lead"
      reason: "Aprovacao de arquitetura"
    - role: "Security Lead"
      reason: "Se threat model identificou riscos altos"
    - role: "Data Lead"
      reason: "Se modelo de dados e complexo"

blockers:
  - "Arquitetura nao documentada"
  - "ADRs obrigatorios nao criados"
  - "Threat model nao realizado para sistemas criticos"
  - "NFRs nao enderecados"
  - "Modelo de dados nao definido"
  - "Contratos de API nao especificados"
