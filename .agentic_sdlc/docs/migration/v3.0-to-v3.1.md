# Migration Guide: v3.0 → v3.1

## Overview

SDLC Agêntico v3.1.0 introduces **Phase 4 (Design System & UX)**, a breaking change that shifts existing phases 4-8 to 5-9.

**What changed:**
- Phase 4 (Planning) → Phase 5 (Planning)
- Phase 5 (Implementation) → Phase 6 (Implementation)
- Phase 6 (Quality) → Phase 7 (Quality)
- Phase 7 (Release) → Phase 8 (Release)
- Phase 8 (Operations) → Phase 9 (Operations)

**New Phase 4:** Design System & UX (between Architecture and Planning)

## Automated Migration (Recommended)

```bash
# Run migration script
python3 .agentic_sdlc/scripts/migrate_to_v3_1.py

# Review changes
git diff .project/

# Commit migration
git add -A
git commit -m "chore: migrate to SDLC Agêntico v3.1.0"
```

**What the script does:**
1. Creates backup: `.claude/settings.json.backup-YYYYMMDD_HHMMSS`
2. Updates phase references in `.project/` files (phase 4→5, 5→6, etc.)
3. Creates design directory structure (`.project/design/`)
4. Copies templates (tokens.yml.example, component-spec, a11y checklist)

## Manual Migration (If Needed)

### Step 1: Update Phase References

Search and replace in `.project/` files:
- `phase: 8` → `phase: 9`
- `phase: 7` → `phase: 8`
- `phase: 6` → `phase: 7`
- `phase: 5` → `phase: 6`
- `phase: 4` → `phase: 5`

### Step 2: Update settings.json (if customized)

If you have custom `.claude/settings.json`, update phase numbers in:
- `complexity_levels` arrays
- Custom phase configurations

### Step 3: Create Design Structure

```bash
mkdir -p .project/design/{specifications,mockups,components,design-system,handoff,brand}
```

### Step 4: Copy Templates

```bash
cp .agentic_sdlc/templates/design-system-tokens.yml .project/design/design-system/tokens.yml.example
cp .agentic_sdlc/templates/component-spec.md .project/design/components/_TEMPLATE.md
cp .agentic_sdlc/templates/accessibility-checklist.md .project/design/
```

## Opting Out of Phase 4

**For backend-only projects:**

Phase 4 automatically skips for:
- Level 0 (Quick Fix): `/quick-fix`
- Level 1 (Feature): `/new-feature`

**To explicitly disable Phase 4 in custom complexity levels:**

```json
{
  "complexity_levels": {
    "custom": {
      "phases": [0, 1, 2, 3, 5, 6, 7] // Skip phase 4
    }
  }
}
```

## Testing the Migration

### Quick Test (Level 0 - Should Skip Phase 4)

```bash
/quick-fix "Fix typo in README"
# Expected: Phases 6, 7 (Implementation, Quality)
# Phase 4 should be skipped
```

### Full Test (Level 2 - Should Include Phase 4)

```bash
/sdlc-start --level 2 "E-commerce product catalog UI"
# Expected: Phases 0, 1, 2, 3, 4, 5, 6, 7, 8
# Phase 4 should execute (Design System & UX)
```

## Rollback Procedure

If migration fails:

```bash
# Restore backup
cp .claude/settings.json.backup-YYYYMMDD_HHMMSS .claude/settings.json

# Revert .project/ changes
git checkout .project/

# Remove design structure
rm -rf .project/design/
```

## Common Issues

### Issue: "Gate 5-to-6 not found"

**Cause:** Old settings.json still references phase 4-to-5  
**Fix:** Update settings.json or run migration script

### Issue: "Design artifacts required but not found"

**Cause:** Level 2/3 project triggered Phase 4  
**Fix:** Either create design artifacts or use Level 0/1

### Issue: "Phase references inconsistent"

**Cause:** Partial migration (some files updated, others not)  
**Fix:** Re-run migration script or manually update all files

## FAQ

**Q: Do I need to migrate existing projects?**  
A: Yes, if you update to v3.1.0. Phase numbers changed.

**Q: Can I skip Phase 4 for all projects?**  
A: Yes, use Level 0/1 or customize complexity levels.

**Q: Will my existing gates still work?**  
A: Gates were renamed automatically. Verify with: `ls .claude/skills/gate-evaluator/gates/`

**Q: Do I need design skills to use Phase 4?**  
A: No. Agents provide templates and guidance. Backend-only projects skip Phase 4.

**Q: Can I use Phase 4 for existing projects?**  
A: Yes! Run `/sdlc-start --level 2 "Redesign project"` to add design system.

## Support

**If migration fails:**
1. Check logs: `.agentic_sdlc/logs/migration.log`
2. Review backup: `.claude/settings.json.backup-*`
3. Create issue: https://github.com/your-repo/issues

**Documentation:**
- Phase 4 Guide: `.agentic_sdlc/docs/phases/phase-4-design-system.md` (TODO)
- Design Tokens: `.agentic_sdlc/docs/guides/design-tokens-guide.md` (TODO)
- Component Specs: `.agentic_sdlc/docs/guides/component-spec-guide.md` (TODO)

---

**Migration Date:** 2026-02-09  
**Framework Version:** v3.1.0  
**Breaking Changes:** Phase numbering (4-8 → 5-9)
